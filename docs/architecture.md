# SabiMarkets System Architecture & Web3 Integration

## Overview
SabiMarkets is a localized, high-performance interface built on top of the Polymarket infrastructure. It is designed specifically to capture the African market by bringing localized news, politics, sports, and economic forecasting into a highly responsive, "Dark Mode Native" financial terminal.

As a Polymarket Builder partner, SabiMarkets leverages the decentralized liquidity and resolution mechanisms of Polymarket while providing a frictionless, tailored UX for African users.

---

## Technical Stack
- **Frontend Framework:** Next.js 16 (App Router) + React 18
- **Styling:** Tailwind CSS + Radix UI + Framer Motion (for micro-animations)
- **Data Visualization:** Recharts (rendering live CLOB tick data)
- **State Management:** Zustand (for ephemeral UI state and local portfolio caching)
- **Web3 Interaction:** `wagmi` / `viem` (for wallet connection and EIP-712 signature requests)
- **Data APIs:** Polymarket Gamma API (REST) & Polymarket CLOB (WebSockets & REST)

---

## üèóÔ∏è Architecture & Component Flow

### 1. Market Indexing & Filtering (Gamma API)
SabiMarkets dynamically indexes active markets from the Polymarket Gamma API. To fulfill its core value proposition, the indexing engine applies a strict localized filter:
- Prioritizes markets containing keywords for all 54 African countries, leaders, major cities, and local currencies.
- Aggressively filters out non-global, hyper-specific U.S. markets (e.g., local state politics, IRS revenue metrics) to maintain a curated, globally relevant feed.

### 2. Deep Liquidity & Real-Time Sync (CLOB)
- SabiMarkets connects to the **Polymarket Central Limit Order Book (CLOB)** via WebSockets.
- Real-time tick updates drive changes perfectly synchronized with Polymarket across the App‚Äôs Marquee ticker, Market Cards, and interactive Recharts graphs.

### 3. Execution Layer (Web3 & Smart Contracts)

#### Current State (MVP Demo Mode)
Currently, SabiMarkets is operating as a **High-Fidelity Simulation (Demo Mode)**. This means it connects to live Polymarket WebSocket feeds for real-time tick data, allows users to connect their real Web3 wallets, and generates real EIP-712 cryptographic signature pop-ups. However, when the user clicks "Sign", the order is tracked in local state (`Zustand` persist) rather than broadcasted to Polymarket's order book. This is specifically designed for safe, zero-cost user testing, MVP pitching, and Builder applications.

#### Production State (Real Trading Integration Roadmap)
To route real money to Polymarket in production, the architecture requires:
- **Proxy Wallets (CTF Exchange):** Users cannot trade directly from their EOA (Externally Owned Account like MetaMask) on Polymarket. Upon their first trade, SabiMarkets must use the `@polymarket/clob-client` SDK to automatically deploy a smart contract Proxy Wallet for the user.
- **USDC Allowances:** The user must sign a transaction granting infinite allowance to the Polymarket Exchange contract to spend USDC from their proxy wallet.
- **CLOB Order Routing:** SabiMarkets must craft the order payload, request an EIP-712 signature from the user, and POST the signed message to Polymarket's Central Limit Order Book (`/order` endpoint) bypassing the gas-heavy on-chain execution for the matching engine.

### 4. Portfolio Tracking
- **MVP Validation:** The portfolio currently stores simulated trades in frontend storage to validate the UX.
- **Production Validation:** In production, SabiMarkets will drop local state and exclusively query the Polymarket `Gamma API (/positions?user=0x...)` and the Polygon blockchain to derive the absolute truth of what Outcome Tokens a user holds. 

---

## üí∞ Monetization Strategy & Rewards Tracking

1. **Polymarket Builder API & Rewards:**
   SabiMarkets uses a unique `NEXT_PUBLIC_POLY_BUILDER_KEY` assigned by Polymarket. Every API request and executed trade routed through our UI includes this header. Polymarket tracks the African volume generated by our frontend using this key, which dictates our eligibility for Builder Grants and volume-based incentive remittances.

2. **Relayer Fees / Frontend Fee Injection:**
   Polymarket's CLOB API allows interface operators (relayers) to append a small percentage fee (e.g., 0.5% - 1%) to trades routed through their specific UI. When users place a large order, a small fraction of the USDC spent goes to the SabiMarkets treasury wallet.

3. **Fiat On/Off-Ramp Affilliates & Infrastructure:**
   African users need Polygon USDC to trade. SabiMarkets plans to integrate localized fiat rails directly into the UI.
   - **How it works:** We integrate widgets or APIs from providers like **Busha**, **YellowCard**, or **Paystack**. 
   - **Deposit Flow:** A user clicks "Deposit Naira". A Busha iframe opens, allowing them to do a local bank transfer. Busha confirms the Naira receipt and automatically mints/transfers equivalent USDC to the user's connected Web3 Wallet address on the Polygon network.
   - **Withdrawal Flow:** The user sends USDC back to the provider, who pays out Naira to their local bank.
   - **Monetization:** SabiMarkets automatically earns an affiliate commission on the spread or volume of every fiat conversion done through our portal.

---

## Security & Custody
- **Self-Custody:** SabiMarkets never holds private keys. User funds are secured by their own wallet provider (MetaMask, Coinbase Wallet, Trust Wallet).
- **No Withdrawal Friction:** Users can withdraw their USDC directly from Polymarket's smart contracts to their wallets at any time.

## Roadmap Forward
- Integrate embedded / abstracted wallets (e.g., Privy or Magic.link) so users can sign up with an Email/Phone number and never realize they are using a Web3 wallet.
- Direct Fiat on-ramps straight to the "Buy" button using local mobile money APIs.
